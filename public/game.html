<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Math Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input {
            width: 50px;
            text-align: center;
        }
        button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>Math Puzzle Game</h1>

    <label for="difficulty">Select Difficulty (1-3 digits): </label>
    <select id="difficulty">
        <option value="1">1-digit</option>
        <option value="2">2-digit</option>
        <option value="3">3-digit</option>
    </select>
    <br><br>

    <button onclick="startGame()">Start Game</button>
    <button id="generateBtn" onclick="generatePuzzleHandler()" disabled>Generate Puzzle</button>
    <button id="checkBtn" onclick="checkAnswer()" disabled>Check Answer</button>

    <h3>Operator: <span id="operator">?</span></h3>

    <div>
        <input type="text" id="num1" disabled> 
        <span id="operatorDisplay1">?</span>
        <input type="text" id="num2" disabled> = 
        <input type="text" id="result1" disabled>
    </div>

    <div>
        <input type="text" id="num3" disabled> 
        <span id="operatorDisplay2">?</span>
        <input type="text" id="num4" disabled> = 
        <input type="text" id="result2" disabled>
    </div>

    <div>
        <input type="text" id="result3" disabled> = 
        <input type="text" id="answer1">
    </div>

    <div>
        <input type="text" id="result4" disabled> = 
        <input type="text" id="answer2">
    </div>

    <p id="feedback"></p>

    <script>
        let currentOperator;
        let result1, result2, result3, result4;
        let correctNum1, correctNum2, correctNum3, correctNum4;
        const allowedOperations = ['+', '-', '*', '/'];

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getFactorPairsInRange(minResult, maxResult) {
            let pairs = [];
            for (let i = 1; i <= Math.sqrt(maxResult); i++) {
                for (let j = i; j <= maxResult; j++) {
                    let product = i * j;
                    if (product >= minResult && product <= maxResult) {
                        pairs.push([i, j]);
                    }
                }
            }
            return pairs;
        }

        function getDivisiblePairsInRange(minResult, maxResult) {
            let pairs = [];
            for (let divisor = 1; divisor <= maxResult; divisor++) {
                for (let result = minResult; result <= maxResult; result++) {
                    let dividend = divisor * result;
                    pairs.push([dividend, divisor]);
                }
            }
            return pairs;
        }

        function generatePuzzle(difficulty, operator) {
            let minResult = Math.pow(10, difficulty - 1);
            let maxResult = Math.pow(10, difficulty) - 1;
            let num1, num2, result;

            switch (operator) {
                case '+':
                    result = getRandomInt(minResult, maxResult);
                    num1 = getRandomInt(1, result - 1);
                    num2 = result - num1;
                    break;
                case '-':
                    result = getRandomInt(minResult, maxResult);
                    num2 = getRandomInt(1, 100);
                    num1 = result + num2;
                    break;
                case '*':
                    let factors = getFactorPairsInRange(minResult, maxResult);
                    if (factors.length === 0) return null;
                    [num1, num2] = factors[Math.floor(Math.random() * factors.length)];
                    result = num1 * num2;
                    break;
                case '/':
                    let dividends = getDivisiblePairsInRange(minResult, maxResult);
                    if (dividends.length === 0) return null;
                    [num1, num2] = dividends[Math.floor(Math.random() * dividends.length)];
                    result = num1 / num2;
                    break;
            }

            return { num1, num2, operator, result };
        }

        function generatePuzzleHandler() {
            const difficulty = parseInt(document.getElementById("difficulty").value);
            const operator = allowedOperations[Math.floor(Math.random() * allowedOperations.length)];
            currentOperator = operator;

            const puzzle1 = generatePuzzle(difficulty, operator);
            const puzzle2 = generatePuzzle(difficulty, operator);

            if (!puzzle1 || !puzzle2) {
                alert("Unable to generate puzzle. Try a different difficulty.");
                return;
            }

            correctNum1 = puzzle1.num1;
            correctNum2 = puzzle1.num2;
            correctNum3 = puzzle2.num1;
            correctNum4 = puzzle2.num2;

            result1 = puzzle1.result;
            result2 = puzzle2.result;

            document.getElementById("num1").value = puzzle1.num1;
            document.getElementById("num2").value = puzzle1.num2;
            document.getElementById("result1").value = puzzle1.result;

            document.getElementById("num3").value = puzzle2.num1;
            document.getElementById("num4").value = puzzle2.num2;
            document.getElementById("result2").value = puzzle2.result;

            result3 = puzzle1.num1 + puzzle2.num1;
            result4 = puzzle1.num2 + puzzle2.num2;

            document.getElementById("result3").value = result3;
            document.getElementById("result4").value = result4;

            document.getElementById("operator").textContent = operator;
            document.getElementById("operatorDisplay1").textContent = operator;
            document.getElementById("operatorDisplay2").textContent = operator;

            document.getElementById("checkBtn").disabled = false;
            document.getElementById("generateBtn").disabled = true;
        }

        function checkAnswer() {
            const ans1 = parseInt(document.getElementById("answer1").value);
            const ans2 = parseInt(document.getElementById("answer2").value);

            const isCorrect = ans1 === result3 && ans2 === result4;
            const feedback = document.getElementById("feedback");

            if (isCorrect) {
                feedback.textContent = "🎉 Correct!";
                feedback.style.color = "green";
            } else {
                feedback.textContent = "❌ Incorrect. Try again!";
                feedback.style.color = "red";
            }

            document.getElementById("generateBtn").disabled = false;
            document.getElementById("checkBtn").disabled = true;
        }

        function startGame() {
            document.getElementById("generateBtn").disabled = false;
            document.getElementById("checkBtn").disabled = true;
            document.getElementById("feedback").textContent = "";
            document.getElementById("answer1").value = "";
            document.getElementById("answer2").value = "";
        }
    </script>
</body>
</html>
