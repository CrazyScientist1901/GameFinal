<!doctype html>
<html lang="en">
<head>
    <!-- (Previous head content remains exactly the same) -->
    <style>
        /* (Previous CSS remains exactly the same) */
    </style>    
</head>
<body>
    <!-- (Previous HTML remains exactly the same until the script) -->

    <script>
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        let currentOperator = ' ';
        let correctNum1, correctNum2, correctNum3, correctNum4;
        let result1, result2, result3, result4;
        let difficulty = 2;
        let allowedOperations = ['+', '-', 'X', '÷'];
        let gameCode = '';

        // ================== UPDATED FUNCTION ==================
        function getRandomNumber(digits) {
            const min = Math.pow(10, digits - 1); // 1→1, 2→10, 3→100
            const max = Math.pow(10, digits) - 1; // 1→9, 2→99, 3→999
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generatePuzzle() {
            if (round > maxRounds) {
                savePlayerData();
                setTimeout(() => {
                    alert("Game Over! Your final score is: " + score);
                    window.location.reload();
                }, 500);
                return;
            }
            
            // Reset UI
            document.getElementById("round").textContent = round;
            document.getElementById("generateBtn").disabled = true;
            document.getElementById("checkBtn").disabled = false;
            document.getElementById("operator").textContent = currentOperator = 
                allowedOperations[Math.floor(Math.random() * allowedOperations.length)];
            
            // Clear previous values
            document.getElementById("num1").value = "";
            document.getElementById("num2").value = "";
            document.getElementById("num3").value = "";
            document.getElementById("num4").value = "";
            document.getElementById("answerBox").textContent = "";
            document.getElementById("answerBox").className = "";

            // ================== UPDATED LOGIC ==================
            switch (currentOperator) {
                case '+':
                    correctNum1 = getRandomNumber(difficulty);
                    correctNum2 = getRandomNumber(difficulty);
                    result1 = correctNum1 + correctNum2;
                    correctNum3 = getRandomNumber(difficulty);
                    correctNum4 = getRandomNumber(difficulty);
                    result2 = correctNum3 + correctNum4;
                    result3 = correctNum1 + correctNum3;
                    result4 = correctNum2 + correctNum4;
                    break;
                    
                case '-':
                    // Ensure non-negative results that match digit count
                    do {
                        correctNum1 = getRandomNumber(difficulty);
                        correctNum2 = getRandomNumber(difficulty);
                    } while (correctNum1 - correctNum2 < 0);
                    result1 = correctNum1 - correctNum2;

                    do {
                        correctNum3 = getRandomNumber(difficulty);
                        correctNum4 = getRandomNumber(difficulty);
                    } while (correctNum3 - correctNum4 < 0);
                    result2 = correctNum3 - correctNum4;

                    result3 = Math.abs(correctNum1 - correctNum3);
                    result4 = Math.abs(correctNum2 - correctNum4);
                    break;
                    
                case 'X':
                    // Avoid trivial multiplications (like 0×N=0)
                    correctNum1 = getRandomNumber(difficulty);
                    correctNum2 = getRandomNumber(difficulty);
                    result1 = correctNum1 * correctNum2;
                    
                    correctNum3 = getRandomNumber(difficulty);
                    correctNum4 = getRandomNumber(difficulty);
                    result2 = correctNum3 * correctNum4;
                    
                    result3 = correctNum1 * correctNum3;
                    result4 = correctNum2 * correctNum4;
                    break;
                    
                case '÷':
                    // Force whole-number results
                    correctNum2 = getRandomNumber(difficulty) || 1; // Avoid division by 0
                    const quotient1 = Math.max(1, Math.floor(Math.random() * 9) + 1);
                    correctNum1 = quotient1 * correctNum2;
                    
                    correctNum4 = getRandomNumber(difficulty) || 1;
                    const quotient2 = Math.max(1, Math.floor(Math.random() * 9) + 1);
                    correctNum3 = quotient2 * correctNum4;
                    
                    result1 = quotient1;
                    result2 = quotient2;
                    result3 = (correctNum1 / correctNum3).toFixed(2);
                    result4 = (correctNum2 / correctNum4).toFixed(2);
                    break;
            }

            // Display results
            document.getElementById("result1").value = result1;
            document.getElementById("result2").value = result2;
            document.getElementById("result3").value = result3;
            document.getElementById("result4").value = result4;
        }

        // (Rest of the functions remain exactly the same: startGame, initGame, savePlayerData)
    </script>
</body>
</html>
