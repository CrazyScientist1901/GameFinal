<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Game</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .parent {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
        }
        button {
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #game {
            display: none;
        }
        #answerBox {
            margin: 10px 0;
            font-weight: bold;
        }
        .correct { color: green; }
        .wrong { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Math Game</h1>
        
        <!-- Login Form -->
        <div id="login">
            <p>Enter your details:</p>
            <input type="text" id="name" placeholder="Name" required>
            <select id="class" required>
                <option value="">Select Class</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
            </select>
            <select id="section" required>
                <option value="">Select Section</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select>
            <button id="startBtn">Start Game</button>
        </div>
        
        <!-- Game Area -->
        <div id="game">
            <p>Round: <span id="round">1</span>/10 | Score: <span id="score">0</span></p>
            
            <div class="parent">
                <input type="number" id="num1" placeholder="Number 1">
                <input type="number" id="num2" placeholder="Number 2">
                <input type="number" id="result1" placeholder="Result 1" readonly>
            </div>
            
            <div class="parent">
                <input type="number" id="num3" placeholder="Number 3">
                <input type="number" id="num4" placeholder="Number 4">
                <input type="number" id="result2" placeholder="Result 2" readonly>
            </div>
            
            <div class="parent">
                <input type="number" id="result3" placeholder="Result 3" readonly>
                <input type="number" id="result4" placeholder="Result 4" readonly>
                <span id="operator" style="text-align:center; font-size:24px;">+</span>
            </div>
            
            <button id="generateBtn">Generate Puzzle</button>
            <button id="checkBtn" disabled>Check Answer</button>
            
            <div id="answerBox"></div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD4mTQJ3pEjkaNrOV5DF7Ixmm-nrnIrkxw",
            authDomain: "mathgame-d8afe.firebaseapp.com",
            databaseURL: "https://mathgame-d8afe-default-rtdb.firebaseio.com",
            projectId: "mathgame-d8afe",
            storageBucket: "mathgame-d8afe.appspot.com",
            messagingSenderId: "339478386785",
            appId: "1:339478386785:web:fe25feb5bcb940c8983220",
            measurementId: "G-DPJ79JZFQ1"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Game variables (EXACTLY as in your original)
        let score = 0;
        let round = 1;
        const maxRounds = 10;
        const operators = ['+', '-', '×', '÷'];
        let currentOperator = '+';
        let correctNum1, correctNum2, correctNum3, correctNum4;
        let result1, result2, result3, result4;

        // DOM elements
        const loginDiv = document.getElementById('login');
        const gameDiv = document.getElementById('game');
        const startBtn = document.getElementById('startBtn');
        const generateBtn = document.getElementById('generateBtn');
        const checkBtn = document.getElementById('checkBtn');

        // Event listeners
        startBtn.addEventListener('click', startGame);
        generateBtn.addEventListener('click', generatePuzzle);
        checkBtn.addEventListener('click', checkResults);

        // YOUR ORIGINAL GAME FUNCTIONS (preserved exactly)
        function startGame() {
            const name = document.getElementById('name').value.trim();
            const cls = document.getElementById('class').value;
            const section = document.getElementById('section').value;
            
            if (!name || !cls || !section) {
                alert('Please fill all fields!');
                return;
            }
            
            // Save player info (only added Firebase-related change)
            localStorage.setItem('currentPlayer', JSON.stringify({
                name: name,
                class: cls,
                section: section,
                score: 0
            }));
            
            // Initialize game (your original logic)
            gameDiv.style.display = 'block';
            loginDiv.style.display = 'none';
            score = 0;
            round = 1;
            document.getElementById('score').textContent = score;
            document.getElementById('round').textContent = round;
            
            generatePuzzle();
        }

        function getRandomNumber(max = 999, min = 0) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function generatePuzzle() {
            if (round > maxRounds) {
                savePlayerData(); // Only added Firebase save
                setTimeout(() => {
                    const player = JSON.parse(localStorage.getItem('currentPlayer'));
                    alert(`Game Over! ${player.name}, your score: ${score}`);
                    gameDiv.style.display = 'none';
                    loginDiv.style.display = 'block';
                }, 500);
                return;
            }
            
            document.getElementById('round').textContent = round;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('checkBtn').disabled = false;
            
            currentOperator = operators[Math.floor(Math.random() * operators.length)];
            document.getElementById('operator').textContent = currentOperator;
            
            // Clear inputs
            document.getElementById('num1').value = '';
            document.getElementById('num2').value = '';
            document.getElementById('num3').value = '';
            document.getElementById('num4').value = '';
            document.getElementById('answerBox').textContent = '';
            document.getElementById('answerBox').className = '';
            
            // YOUR ORIGINAL PUZZLE GENERATION LOGIC
            switch (currentOperator) {
                case '+':
                    correctNum1 = getRandomNumber();
                    correctNum2 = getRandomNumber();
                    result1 = correctNum1 + correctNum2;
                    correctNum3 = getRandomNumber();
                    correctNum4 = getRandomNumber();
                    result2 = correctNum3 + correctNum4;
                    result3 = correctNum1 + correctNum3;
                    result4 = correctNum2 + correctNum4;
                    break;
                case '-':
                    correctNum1 = getRandomNumber();
                    correctNum2 = getRandomNumber(correctNum1 - 1);
                    result1 = correctNum1 - correctNum2;
                    correctNum3 = getRandomNumber();
                    correctNum4 = getRandomNumber(correctNum3 - 1);
                    result2 = correctNum3 - correctNum4;
                    result3 = correctNum1 - correctNum3;
                    result4 = correctNum2 - correctNum4;
                    break;
                case '×':
                    correctNum1 = getRandomNumber();
                    correctNum2 = getRandomNumber();
                    result1 = correctNum1 * correctNum2;
                    correctNum3 = getRandomNumber();
                    correctNum4 = getRandomNumber();
                    result2 = correctNum3 * correctNum4;
                    result3 = correctNum1 * correctNum3;
                    result4 = correctNum2 * correctNum4;
                    break;
                case '÷':
                    correctNum2 = getRandomNumber(5) + 1;
                    result1 = getRandomNumber(5) + 1;
                    correctNum1 = result1 * correctNum2;
                    correctNum4 = getRandomNumber(5) + 1;
                    result2 = getRandomNumber(5) + 1;
                    correctNum3 = result2 * correctNum4;
                    result3 = correctNum1 / correctNum3;
                    result4 = correctNum2 / correctNum4;
                    break;
            }
            
            // Set results
            document.getElementById('result1').value = result1;
            document.getElementById('result2').value = result2;
            document.getElementById('result3').value = result3;
            document.getElementById('result4').value = result4;
        }

        function checkResults() {
            const num1 = parseInt(document.getElementById('num1').value) || 0;
            const num2 = parseInt(document.getElementById('num2').value) || 0;
            const num3 = parseInt(document.getElementById('num3').value) || 0;
            const num4 = parseInt(document.getElementById('num4').value) || 0;
            const answerBox = document.getElementById('answerBox');
            
            let allCorrect = true;
            
            // YOUR ORIGINAL VALIDATION LOGIC
            switch(currentOperator) {
                case '+':
                    allCorrect = (num1 + num2 === result1) && 
                                (num3 + num4 === result2) &&
                                (num1 + num3 === result3) &&
                                (num2 + num4 === result4);
                    break;
                case '-':
                    allCorrect = (num1 - num2 === result1) && 
                                (num3 - num4 === result2) &&
                                (num1 - num3 === result3) &&
                                (num2 - num4 === result4);
                    break;
                case '×':
                    allCorrect = (num1 * num2 === result1) && 
                                (num3 * num4 === result2) &&
                                (num1 * num3 === result3) &&
                                (num2 * num4 === result4);
                    break;
                case '÷':
                    if (num2 === 0 || num4 === 0 || num3 === 0) {
                        allCorrect = false;
                        break;
                    }
                    allCorrect = (Math.abs(num1 / num2 - result1) < 0.0001) && 
                                (Math.abs(num3 / num4 - result2) < 0.0001) &&
                                (Math.abs(num1 / num3 - result3) < 0.0001) &&
                                (Math.abs(num2 / num4 - result4) < 0.0001);
                    break;
            }
            
            if (allCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                answerBox.textContent = 'Correct!';
                answerBox.className = 'correct';
            } else {
                answerBox.innerHTML = `Incorrect!<br>Correct answers:<br>
                    num1 = ${correctNum1}<br>
                    num2 = ${correctNum2}<br>
                    num3 = ${correctNum3}<br>
                    num4 = ${correctNum4}`;
                answerBox.className = 'wrong';
            }
            
            round++;
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('generateBtn').disabled = false;
        }

        // ONLY NEW FUNCTION - Firebase save
        function savePlayerData() {
            const player = JSON.parse(localStorage.getItem('currentPlayer'));
            if (!player) return;
            
            player.score = score;
            player.timestamp = firebase.database.ServerValue.TIMESTAMP;
            
            db.ref('players/' + Date.now()).set(player)
                .then(() => console.log('Score saved'))
                .catch(err => console.error('Save error:', err));
        }
    </script>
</body>
</html>
